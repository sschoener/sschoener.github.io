---
layout: post
title: Ultrafilters, Profinite Words, Topology
subtitle: An introduction to Stone Duality
excerpt: In which I continue the last post on Stone Duality, introducing ultrafilter, profinite words, and a bit of topology.
tags: [mathematics, computer science, logic]
---
\\(\newcommand{\mc}[1]{\mathcal{\#1}} \newcommand{\comp}[1]{\#1^{\mathsf{\#1}}}\\)
# Preface
This is the second part of an introduction to Stone Duality in the context of formal language theory. See the [first post]({% post_url 2018-10-10-stone-duality-intro-1 %}) for more information.

# Introduction
In the last post, we discussed a few central definitions:
 * a *field of sets* or *Boolean algebra with intersection, union, and complement* \\(B\\) (short: algebra) is a non-empty family of subsets of \\(\Sigma^\*\\) that is closed under intersection, union, and complement,
 * for such a field of sets \\(B\\), a subset \\(\mu \subseteq B\\) is called a *full specification* if
   * \\(\mu \neq \emptyset\\),
   * \\(\emptyset \notin \mu\\) and \\(\mu\\) is closed under intersection (consistency),
   * for every \\(L \in B\\), either \\(L\in \mu\\) or \\(\comp{L} \in \mu\\) (completeness).

# Ultrafilters
Our full specifications from above are better known as *ultrafilters* (yes, the same ultrafilters that you know and love from topology). Recall the definition of an ultrafilter on a set \\(X\\): A family of sets \\(\mc{F} \subseteq \mc{P}(X)\\) is a *filter base* if:
 * \\(\mc F\\) is not empty, and
 * \\(\emptyset \notin \mc{F}\\), and
 * if \\(L\_1, L\_2 \in \mc{F}\\), then \\(L\_1 \cap L\_2 \in \mc{F}\\) (closed under intersection).

Furthermore, a filter base \\(\mc{F}\\) is a *filter* if whenever \\(L\_1 \in \mc{F}\\) and \\(L\_2 \in \mc{P}(X)\\) with \\(L\_1 \subseteq L\_2\\), then \\(L\_2 \in \mc{F}\\) (closed under extension).

In a slight variation, a filter of a field of sets \\(B\\) is defined in the same way with all instances of \\(\mc{P}(X)\\) replaced by \\(B\\). An *ultrafilter* is a maximal filter in both cases.

Filters are denoted by upper case letters \\(\mc{F, G, H}\\), ultrafilters are denoted by lowercase greek letters such as \\(\mu, \nu, \gamma\\). Similarly to the existence proof referred to above, it is usually proved that each filter can be extended to an ultrafilter (and therefore so can each filter base).

Let us quickly see that each \\(B\\)-specifcation is an ultrafilter of \\(B\\) and vice versa:
 * A \\(B\\)-specification \\(S\\) is a filter of \\(B\\): The first three properties are true by definition. The fourth (closure under extension) follows because if \\(L\_2 \notin S\\), then \\(\comp{L\_2} \in S\\) by completeness and hence \\(\emptyset = \comp{L\_2} \cap L\_1 \in S\\), *contradiction*. Maximality is an immediate consequence of completeness.
 * Conversely, if \\(\mu\\) is an ultrafilter of \\(B\\), then it is consistent by definition. If neither \\(L\\) nor its complement are in the ultrafilter for any \\(L\\), then the ultrafilter does not contain a subset of either. Since it is non-empty, it must contain a set \\(U \in B\\) that has non-empty intersection with \\(L\\) and its complement. If there is a set \\(V \in \mu\\) such that \\(V \cap U \cap L = \emptyset\\), then clearly \\(V \cap U \subseteq \comp{L}\\), meaning that \\(\comp{L} \in \mu\\). Otherwise, for all \\(V \in \mu\\) we have \\(V \cap U \cap L \neq \emptyset\\), meaning that \\(\mu \cup \\{U \cap L\\}\\) is a filter base, hence can be extended to a filter. Then by maximality \\(U \cap L \in \mu\\), hence \\(L \in \mu\\).

## Examples of Ultrafilters
Let \\(B\\) be any field of sets on \\(\Sigma^\*\\). For any \\(w\in \Sigma^\*\\), there is an ultrafilter \\(\mu\_w\\) that is generated by the filter base \\(\\{w\\}\\), i.e. the ultrafilter of all sets that contain \\(w\\). Ultrafilters that contain such a singleton set are called *fixed* -- they specify a word that actually exists. This is in stark contrast to ultrafilters that do not contain such a singleton, these are called *free*.

Here are a few examples: 
 * Consider the field of sets generated by all finite subsets of \\(\Sigma^*\\). It consists of all finite and all co-finite sets (complements of finite sets). Each word generates a distinct fixed ultrafilter for this Boolean algebra given as the collection of all finite or cofinite sets that contain this word. Additionally, there is a single additional ultrafilter \\(\mu\\) that contains all cofinite sets. It does not represent a real word, but simply an entity that has the property of being a word (because \\(\Sigma^\* \in \mu\\)) but is none of the words you know. To me, it seems that it does not really have any other interesting properties: The cofinite sets merely encode that it is not a word.
 * Consider the field of sets generated by \\((\Sigma^2)^\*\\). It is a finite field of sets and contains  \\(\emptyset, \Sigma^\*\\), the set \\(E\\) of all words with even length, and the set \\(O\\) of all words with odd length. Each word \\(w\\) generates an ultrafilter, but they are no longer distinct. In fact, \\(\mu\_w\\) is the set \\(\\{\Sigma^\*, E\\}\\) if \\(\|w\|\\) is even and \\(\\{\Sigma^\*, O\\}\\) otherwise. There are no other ultrafilters.
 * In fact, whenever \\(B\\) is a finite Boolean algebra, the ultrafilters of \\(B\\) are in one-to-one correspondence to the *atoms* of \\(B\\). These are the elements of the algebra that sit just above the bottom element, which is \\(\emptyset\\) in our case. In the last example, both \\(E\\) and \\(O\\) are atoms, since there is no element \\(X \neq E\\) in the algebra that satisfies \\(\emptyset \subseteq X \subseteq E \\) (and respectively for \\(O\\)).
 * Consider the field of sets generated by all finite sets and the set of all words of even length \\(E\\). Again, each word corresponds to a distinct fixed ultrafilter. There are two free ultrafilters, they are generated by the filter bases consisting of all cofinite sets and either \\(E\\) or \\(O\\). Compared to the first example, it is not wrong that by adding in another property to talk about (whether the word has even length, \\(E\\)) we split the free ultrafilter of the first example into two slightly more interesting free ultrafilters: A non-finite word that has even length and a non-finite word that has odd length.

# Ultrafilters and Topology
As I mentioned before, ultrafilters are also a prominent notion in topology. So what is the connection here? Well, since I presume that your background is in formal language theory, I do not expect you to know a lot of topology. But surely you are familiar with metric spaces, so let's live a lie and concentrate on these first by considering the example where the Boolean algebra under consideration is that of the regular languages. If you are familiar with profinite words, let me spoil this for you right now: Ultrafilters for this algebra *are* profinite words. If you are not familiar with profinite words, listen carefully.

## Profinite Words
A construction that has proven fruitful in formal language theory, yet may seem contrived the first time you see it is that of the *profinite metric* for regular languages. We will use it to study the ultrafilters of the Boolean algebra of regular languages. Recall that regular languages can be conveniently recognized by morphisms into finite monoids. That is, a language \\(L \subseteq \Sigma^\*\\) is regular (or rather, recognizable) if and only if there is a finite monoid \\(M\\) and a morphism of monoids \\(\varphi \colon \Sigma^* \to M\\) such that \\(L = \varphi^{-1}(F)\\) for some set \\(F \subseteq \Sigma^*\\). We can construct a metric based on these finite monoids:

### The Profinite Metric
For words \\(v, w \in \Sigma^\*\\), let \\(r(v, w)\\) be the size of the smallest monoid \\(M\\) such that there is a morphism \\(\varphi \colon \Sigma^\* \to M\\) that *separates* \\(v\\) and \\(w\\), meaning that \\(\varphi(v) \neq \varphi(w)\\). If there is no such monoid and morphism, set \\(r(v, w) = \infty\\). It is easily seen that non-equal words are always separated by some morphism. Now let \\(d \colon \Sigma^\* \times \Sigma^\* \to \mathbb{R}\\) be defined by \\(d(v, w) = 2^{-r(v,w)}\\), with \\(2^{-\infty} = 0\\). This is not only a metric[^metric], but actually an ultra-metric.

The resulting metric space is of limited interest, because it is *discrete*, i.e. if a sequence converges, then it is ultimately constant. But there are non-convergent sequences that are of interest to us, namely the non-convergent Cauchy-sequences in the space. One example of such a sequence is \\((w^{n!})\_{n \in \mathbb{N}}\\) for any non-empty word \\(w\\).

{% capture proof-capture %}
It suffices to prove that for each \\(N\\) and all \\(m, n \geq N\\) we can bound \\(d(w^{n!}, w^{m!}) \leq 2^{-N}\\). Let \\(M\\) be a monoid of size at most \\(N\\).

As a preliminary result, we will prove that every element \\(x \in M\\) has an idempotent power \\(e\\), i.e. an element \\(e = x^r\\) such that \\(e = e^2\\).
Note that the sequence \\(x^0, x, x^2, x^3, \ldots, x^N\\) must have a repetition. Let \\(i\\) be the first occurence of the repeated element and \\(k\\) the absolute distance between the two repetitions. Then \\(x^i = x^{i + k}\\) and inductively \\(x^i = x^{i + kn}\\) for all \\(n\\). Note especially that \\(x^i = x^{i + ki} = x^{i(k+1)}\\).

The element \\(x^{ik}\\) is idempotent:
\\[
  x^{ik} x^{ik} = x^{i(k+1)}x^{i(k-1)} = x^i x^{i(k-1)} = x^{ik},
\\]
where \\(k \geq 1\\). Hence \\(x^{ik}\\) is idempotent. Note that even though \\(ik\\) is not generally less or equal to \\(\|M\|\\), this also means that there is a \\(l \leq \|M\|\\) such that \\(x^l = x^{ik}\\).

Now consider any morphism \\(\varphi \colon \Sigma^\* \to M\\). The element \\(\varphi(w)\\) has an idempotent power \\(\varphi(w)^k\\) with \\(k \leq N\\). Therefore \\(\varphi(w)^{m!} = \varphi(w)^k = \varphi(w)^{n!}\\) whenever \\(n, m \geq N\\), thus \\(d(w^{n!}, w^{m!}) \leq 2^{-N}\\).
{% endcapture%}
{% include widgets/toggle-field.html toggle-name="toggle-proof" button-text="Show Proof" toggle-text=proof-capture %}

### The Free Profinite Monoid
It therefore makes sense to consider the completion of \\(\Sigma^\*\\) w.r.t. \\(d\\). This basically just adds extra points to the space that represent the previously non-existing limits of Cauchy-sequences, for example \\(\lim\_{n\to\infty} w^{n!} = : w^\omega\\). The resulting space is the *free profinite monoid* on \\(\Sigma\\) and is denoted by \\(\widehat{\Sigma^\*}\\). Topologically, it is
 * *Hausdorff* (as are all metric spaces), meaning that each pair of pairs can be told apart by the topology,
 * *zero-dimensional* (as are all ultrametric spaces), meaning here that the space is totally disconnected ,
 * *compact*, meaning that the space is small*ish* and behaves like a finite space in many ways.

Do not worry about these terms right now.

The elements of \\(\widehat{\Sigma^\*}\\) are called *profinite words*. As the name *free profinite monoid* implies, it has a universal property and is a monoid. Specifically, any function \\(\varphi \colon \Sigma \to M\\) for \\(M\\) a finite monoid lifts uniquely to a morphism of monoids \\(\hat\varphi \colon \widehat{\Sigma^\*} \to M\\), and the monoid operation (concatenation) is defined by elementwise concatenation of the representatives of the equivalence classes of Cauchy-sequences that are the profinite words.

#### Aside on Compact Spaces
I am not going to pretend that these topological properties are easy to understand if you have no experience with topology. Forget about the Hausdorff property and zero-dimensionality. Compactness is much more important for us. For this space, the fact that it is compact is equivalent to the fact that each sequence has a convergent subsequence. Morally, this is true for all spaces, but some spaces are just too big to restrict themselves to sequences to formulate their properties.

I like to imagine compact spaces as the perfect setting for a horror movie: There is nowhere to run. A space is compact if no matter where you go, you always end up somewhere in the space. To illustrate this point, note that \\(\mathbb{R}\\) is *not* compact, because you can make a good attempt to escape the space by running towards infinity -- and you will never end up anywhere, you can just keep going. On the hand, \\(\mathbb{R}\\) with a point added to represent both negative and positive infinity (or even a point for each, if you are feeling generous), *is* compact space, because you *cannot* escape, you just end up at infinity at some point. If that didn't help, imagine pouring water into your space. If it leaks out somewhere or vanishes in the infinite, your space is not compact and you need to install a few plugs (read: add points) to compactify it.

[^metric]: This construction works whenever the algebra \\(B\\) is countable: Arrange \\(B\\) in some arbitrary order \\(L\_1, L\_2, \ldots\\). Then let \\(r(v, w)\\) be the smallest index \\(i\\) for which \\(L\_i\\) separates \\(w\\) and \\(v\\) or \\(\infty\\) if no such index exists. Finally, \\(d(v, w) = 2^{-r(v, w)}\\). This will not necessarily be a metric (notably in cases where \\(B\\) fails to separate each pair of words), but it is always a pseudo-metric, and this is sufficient for us.